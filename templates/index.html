<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard des ventes</title>
    
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4" id="app">
        <h1 class="text-3xl font-bold text-center mb-8">
            ðŸ“Š Dashboard des ventes
        </h1>

        <!-- Statistiques -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="bg-white p-6 rounded-lg shadow-md animate__animated animate__fadeInUp">
                <h2 class="text-xl font-semibold">Total des billets vendus</h2>
                <p class="text-2xl mt-2 font-bold text-blue-600" id="totalTickets">0</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md animate__animated animate__fadeInUp">
                <h2 class="text-xl font-semibold">Revenus totaux</h2>
                <p class="text-2xl mt-2 font-bold text-green-600" id="totalRevenue">0 CHF</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md animate__animated animate__fadeInUp">
                <h2 class="text-xl font-semibold">Dernier billet vendu</h2>
                <p class="text-2xl mt-2 font-bold text-red-600" id="lastTicket">Aucun billet vendu</p>
            </div>
        </div>

        <!-- Tableau des billets vendus -->
        <div class="bg-white p-6 rounded-lg shadow-md animate__animated animate__fadeIn">
            <h2 class="text-xl font-semibold mb-4">DÃ©tails des billets vendus</h2>
            <table class="min-w-full bg-white border">
                <thead>
                    <tr>
                        <th class="py-2 border">NumÃ©ro</th>
                        <th class="py-2 border">Ã‰vÃ©nement</th>
                        <th class="py-2 border">Acheteur</th>
                    </tr>
                </thead>
                <tbody id="ticketsTableBody"></tbody>
            </table>
        </div>
    </div>

    <!-- Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const tickets = JSON.parse('{{ tickets | safe }}'); // RÃ©cupÃ©rer les tickets envoyÃ©s par Flask

            // Mise Ã  jour du tableau des billets
            const ticketsTableBody = document.querySelector("#ticketsTableBody");
            tickets.forEach(ticket => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td class="py-2 text-center">${ticket.ticket_number}</td>
                    <td class="py-2 text-center">${ticket.event_name}</td>
                    <td class="py-2 text-center">${ticket.buyer_name}</td>
                `;
                ticketsTableBody.appendChild(row);
            });

            // Mettre Ã  jour les statistiques
            document.querySelector("#totalTickets").innerText = tickets.length;
            document.querySelector("#totalRevenue").innerText = tickets.length * 25; // Supposition : 25 CHF par billet
            document.querySelector("#lastTicket").innerText = tickets.length > 0 ? tickets[tickets.length - 1].ticket_number : "Aucun billet vendu";
    
            // GÃ©nÃ©rer les statistiques d'Ã©vÃ©nements
            const eventCounts = {};
            tickets.forEach(ticket => {
                eventCounts[ticket.event_name] = (eventCounts[ticket.event_name] || 0) + 1;
            });
    
            const labels = Object.keys(eventCounts);
            const values = Object.values(eventCounts);
    
            // GÃ©nÃ©rer le graphique
            new Chart(document.getElementById("eventsChart"), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Nombre de tickets",
                        data: values,
                        backgroundColor: "rgba(75, 192, 192, 0.2)",
                        borderColor: "rgba(75, 192, 192, 1)",
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        });
    </script>
</body>
</html>
